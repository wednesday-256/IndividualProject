<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>After School Activities</title>
    <script src="lessons.js"></script>
  </head>
  <style>
    * {
      font-family: arial;
    }
    .headerBox {
      background-color: darkgreen;
      padding: 10px;
    }
    .sitename {
      color: ivory;
    }
    .prBtn {
      background-color: yellow;
    }
    .prBtn:hover {
      background-color: ivory;
    }

    .controlBox {
      border-radius: 7px;
    }

    #inputBox {
      width: 500px;
      border-radius: 7px;
      padding: 3px 10px;
    }

    .lessonImage {
      max-width: 190px;
      max-height: 190px;
    }

    #inputBox:focus {
      background-color: #198754;
      color: ivory;
    }

    .lesson {
      background-color: ivory;
      border-radius: 10px;
    }

    .lesson:hover {
      border: 1px solid #198754;
    }
  </style>
  <body>
    <div id="app">
      <!-- header box -->
      <div
        class="bg-success p-2 d-flex justify-content-between align-items-center justify-content-lg-around mb-3"
      >
        <h4 class="sitename">{{sitename}}</h4>

        <div class="checkoutBox">
          <button
            class="btn-warning btn position-relative m-1"
            v-if="canCheckout"
            type="button"
          >
            Checkout
            <span
              class="badge bg-danger position-absolute top-0 start-100 translate-middle round-pill"
              >{{cartCount}}</span
            >
          </button>
        </div>
      </div>

      <!-- controls box  -->
      <div
        class="container p-4 bg-light controlBox d-flex flex-column flex-lg-row justify-content-around align-items-center"
      >
        <div class="searchBox d-flex">
          <input
            id="inputBox"
            type="text"
            placeholder="Enter Search Term"
            v-model="searchTerm"
            @keyup="handleChange"
          />
        </div>

        <div class="toolBox container">
          <!-- sort section  -->
          <div
            class="sortBox d-flex flex-column m-3 p-2 justify-content-between"
          >
            <div class="btn-group" role="group">
              <input
                class="btn-check"
                type="radio"
                name="attribute"
                id="subject"
                autocomplete="off"
                value="subject"
                checked
                v-model="sortAttr"
              />
              <label class="btn btn-outline-success" for="subject"
                >Subject</label
              >
              <input
                class="btn-check"
                name="attribute"
                type="radio"
                id="location"
                autocomplete="off"
                value="location"
                v-model="sortAttr"
              />
              <label class="btn btn-outline-success" for="location"
                >Location</label
              >
              <input
                class="btn-check"
                name="attribute"
                type="radio"
                id="price"
                value="price"
                v-model="sortAttr"
                autocomplete="off"
              />
              <label class="btn btn-outline-success" for="price">Price</label>
              <input
                class="btn-check"
                name="attribute"
                type="radio"
                id="available"
                value="available"
                v-model="sortAttr"
                autocomplete="off"
              />
              <label class="btn btn-outline-success" for="available"
                >Availablity</label
              >
            </div>
            <div class="mt-3 p-2 btn-group" role="group">
              <input
                class="btn-check"
                type="radio"
                id="ascending"
                autocomplete="off"
                value="ascending"
                name="order"
                checked
                v-model="order"
              />
              <label class="btn-outline-success btn" for="ascending"
                ><i class="bi bi-arrow-up me-1"></i>Ascending</label
              >
              <input
                type="radio"
                class="btn-check"
                id="descending"
                value="descending"
                v-model="order"
                autocomplete="off"
                name="order"
              />
              <label class="btn-outline-success btn" for="descending"
                ><i class="bi bi-arrow-down me-1"></i>Descending</label
              >
            </div>
          </div>
        </div>
      </div>

      <!-- result box  -->
      <div
        class="resultBox container d-flex justify-content-around align-items-center flex-wrap"
      >
        <div class="d-flex m-3 lesson p-3" v-for="lesson in sortedLessons">
          <div class="d-flex justify-content-center align-items-center">
            <div class="me-2">
              <figure>
                <img class="lessonImage" :src="lesson.image" />
              </figure>
            </div>
            <div class="ms-1 h-90">
              <p><strong>Subject: </strong>{{lesson.subject}}</p>
              <p><strong>Location: </strong>{{lesson.location}}</p>
              <p><strong>Price: </strong>{{lesson.price | formatPrice}}</p>
              <p><strong>Spaces: </strong>{{numOfSpaces(lesson)}}</p>

              <button
                v-if="canAddToCart(lesson)"
                class="btn btn-success"
                @click="addToCart(lesson)"
              >
                <i class="bi bi-plus-lg me-1"></i> Add to cart
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript">
      const webApp = new Vue({
        el: "#app",
        data: {
          sitename: "After School Activities",
          lessons: lessons,
          searchTerm: "",
          sortAttr: "subject",
          order: "ascending",
          cart: {
            lout: "3243",
          },
          showProduct: true,
          order: {
            firstName: "",
            lastName: "",
            address: "",
            city: "",
            zip: "",
            state: "",
            method: "Home Address",
            business: "Business Address",
            home: "Home Address",
            gift: "Do Not Send As a Gift",
            sendGift: "Send As a Gift",
            dontSendGift: "Do Not Send As a Gift",
          },
        },
        filters: {
          // formats price
          formatPrice(price) {
            if (!parseInt(price)) {
              throw Error("expects int or float value"); //throws error if the price valu is not an integer
            }

            return price.toLocaleString("en-US", {
              style: "currency",
              currency: "AED",
              minimumFractionsDigits: 2,
            });
          },
        },
        methods: {
          addToCart(lesson) {
            this.cart.push(lesson);
          },
          showCheckout() {
            this.showLesson = !this.showLesson; //flips the showLesson value
          },
          removeFromCart(lesson) {
            this.cart.splice(this.cart.indexOf(lesson));
          },
          handleChange() {
            console.log(this.searchTerm, "this is handle event");
            console.log(this.order, " >> this is the order");
            console.log(this.lessons);
            console.log(this.sortAttr, " >> this is the sortAttr");
          },
          canAddToCart(lesson) {
            if (this.cart[lesson.id] === undefined) {
              return true;
            }
            return lesson.availableSpaces - this.cart[lesson.id] > 0;
          },
          numOfSpaces(lesson) {
            if (this.cart[lesson.id] === undefined) {
              return 5;
            }
            return lesson.availableSpaces - this.cart[lesson.id];
          },
        },
        computed: {
          cartCount() {
            return Object.values(this.cart).length;
          },
          canCheckout() {
            return this.cartCount > 0;
          },
          sortedLessons() {
            let lessonArray = this.lessons.slice(0);
            // check function
            const check = (a) => {
              if (typeof a === String) {
                return a.toLowerCase();
              } else {
                return a;
              }
            };

            // sort function
            const compare = (a, b) => {
              if (check(a[this.sortAttr]) < check(b[this.sortAttr])) {
                return -1;
              }
              if (check(a[this.sortAttr]) < check(b[this.sortAttr])) {
                return 0;
              }
            };

            return lessonArray.sort(compare);
          },
        },
      });
    </script>
  </body>
</html>
